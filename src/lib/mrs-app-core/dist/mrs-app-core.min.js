/*! mrs-app-core - v1.0.0 - 2015-06-30 13:01:55 GMT */
function MRSAppKernel_BootPack(){"use strict";this.bootModule="",this.bootConfig=""}function MRSAppKernel_IOPack(){"use strict"}function MRSAppKernel_SettingsPack(){"use strict";this.buildKey=function(a){return"MRSAPPSETTINGS_"+a.toUpperCase().replace(/\./gi,"")},this.buildValue=function(a){return{timestamp:(new Date).toISOString(),data:a}}}function FileProvider(){"use strict";this.filePath="",this.$get=function(){var a,b,c=this.filePath;return{isPluginEnabled:function(){var a=void 0!==window.requestFileSystem&&null!==window.requestFileSystem&&(void 0!==window.cordova||void 0!==window.phonegap);return a},onIOFailure:function(a){throw"INTERNAL IO FAILURE: "+a},onGotFW:function(b){b.seek(b.length),b.write(a)},onGotFE:function(a){a.createWriter(this.onGotFW,this.onIOFailure)},onGotFS:function(a){a.root.getFile(b,{create:!0,exclusive:!1},this.onGotFE,this.onIOFailure)},writeLine:function(d,e,f){b=c+d,a="\n"+e,window.requestFileSystem(LocalFileSystem.PERSISTENT,0,this.onGotFS,f)}}}}function webHelperProvider(){"use strict";this.cacheRules=[],this.$get=function(){var a=this.cacheRules;return{filter:function(b,c,d){var e,f,g=a.length,h=(new Date).getTime();if(void 0===c||null===c)return null;if(void 0===c.CACHE_TIMESTAMP)return c;if(void 0!==d)return h-c.CACHE_TIMESTAMP>d?null:c;for(e=0;g>e;e+=1)if(f=a[e],0===b.indexOf(f.service.toLowerCase())){if(h-c.CACHE_TIMESTAMP>f.timeout)return null;break}return c},formatResponse:function(a,b,c,d){var e={data:a,status:b,headers:c||function(){return void 0},config:d||{}};return e}}}}function webSqlProvider(){"use strict";var a=this;this.websqldb={},this.sync=function(b){var c=window.openDatabase(a.websqldb.dbname,a.websqldb.version,a.websqldb.description,a.websqldb.size);c.transaction(function(a){angular.forEach(b,function(b){a.executeSql(b)})})},this.$get=function(){var a=this.websqldb;return{db:void 0,open:function(){if(void 0===this.db&&(this.db=window.openDatabase(a.dbname,a.version,a.description,a.size),void 0===this.db))throw"UNABLE TO OPEN WEBSQL DATABASE: "+JSON.stringify(a);return this.db}}}}window.tlantic=function(){"use strict";return{}}(),MRSAppKernel_BootPack.prototype.loadAngApp=function(a,b,c,d,e){"use strict";var f=this,g=function(a,b){function c(b){var c,e,f;for(c in b)if(e=b[c],void 0!==e.module)try{console.log("MRS-APP-BOOT",e.module,JSON.stringify(e)),e=window.tlantic.settings.get(e.module)||e,f="$"+e.module.toLowerCase().replace(/\./gi,"")+"Config",angular.module(e.module).constant(f,e)}catch(g){console.error("MRS-APP-BOOT",g)}angular.bootstrap(document,[a]),d&&d()}function g(a){if(!e)throw"ERROR LOADING <"+b+"> : "+a;e(a)}if(void 0===angular)throw"BOOT ERROR: ANGULARJS NOT FOUND";try{angular.module(a)}catch(h){throw"MODULE <"+a+"> IS NOT DEFINED"}finally{f.bootModule=a,f.bootConfig=b}window.tlantic.io.readJSONFile(b,c,g)};c?angular.element(document).ready(function(){g(a,b)}):g(a,b)},window.tlantic.boot=new MRSAppKernel_BootPack,MRSAppKernel_IOPack.prototype.readJSONFile=function(a,b,c){"use strict";var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status||0===d.status)try{b&&b(JSON.parse(d.responseText))}catch(a){console.error("readJSONFile error",a),c(-1)}else c(d.status)},d.send(null)},window.tlantic.io=new MRSAppKernel_IOPack,MRSAppKernel_SettingsPack.prototype.get=function(a){var b;if("string"!=typeof a)return void 0;try{a=this.buildKey(a),b=window.localStorage.getItem(a)}catch(c){console.error("MRS-APP-SETTINGS","get",c)}if(void 0===b)return b;try{b=JSON.parse(b),b=b.data}catch(c){console.log(b),console.error("MRS-APP-SETTINGS","get-parse",c)}return b},MRSAppKernel_SettingsPack.prototype.set=function(a,b){if("string"!=typeof a||!b)return void 0;try{a=this.buildKey(a),b=JSON.stringify(this.buildValue(b)),window.localStorage.setItem(a,b)}catch(c){console.error("MRS-APP-SETTINGS","set",c)}return b},window.tlantic.settings=new MRSAppKernel_SettingsPack,angular.module("MRS.App.Core",[]),angular.module("MRS.App.Core").config(["$mrsappcoreConfig","$provide","$httpProvider",function(a,b,c){"use strict";var d,e,f={log:{debug:!0,saveToFile:!1},authentication:{url:"http://auth.mrs.com/"},fileProxy:{path:""},webHelper:{rules:[]},websql:{database:{}}};e=angular.extend({},f,a),angular.extend(a,e),c.interceptors.push("authenticationInterceptor"),c.interceptors.push("webInterceptor"),d=b.provider("fileProxy",FileProvider),d.filePath=a.fileProxy.path,d=b.provider("webHelper",webHelperProvider),d.cacheRules=a.webHelper.rules,d=b.provider("websqlProxy",webSqlProvider),d.websqldb=a.websql.database,b.decorator("$log",["$delegate","logger",function(b,c){return c(b,a.log.debug)}])}]),angular.module("MRS.App.Core").run(["$mrsappcoreConfig","$injector",function(a,b){"use strict";b.get("authentication").url=a.authentication.url}]),angular.module("MRS.App.Core").factory("authenticationInterceptor",["authentication",function(a){"use strict";return{request:function(b){var c=a.getSessionID();return c&&b.auth&&(b.headers["X-Tlantic-SessionId"]=c,delete b.auth),b}}}]),angular.module("MRS.App.Core").service("authentication",["$injector","$log",function(a,b){"use strict";var c,d=this;d.url="",d.getSessionID=function(){return c},d.setSessionID=function(a){c=a},d.authenticate=function(e,f,g,h,i){var j,k=a.get("webProxy"),l={url:d.url,method:"POST",data:{userId:e,password:f,clientTypeId:g}};j=k.send(l),j.then(function(a){c=a.data.SessionId,h&&h(a)},function(a){b.error("Authentication error."),i&&i(a)})}}]),angular.module("MRS.App.Core").service("dataConnector",["$injector","$log",function(a,b){"use strict";var c={ONLINE_WITHCACHE:{proxy:"webProxy",cache:!0},ONLINE_NOCACHE:{proxy:"webProxy",cache:!1},ONLINE:{proxy:"webProxy",cache:!1,forceHit:!0},OFFLINE:{proxy:"sqliteProxy"}};this.getPolicies=function(){return c},this.fetch=function(c,d){var e;b.debug("DataConnector.fetch()"),b.debug("Request: "+JSON.stringify(c));try{return b.debug("Fetching data using proxy: "+d.proxy),e=a.get(d.proxy),b.debug("Sending request..."),c.cache=d.cache,c.forceHit=d.forceHit,e.send(c)}catch(f){b.error("PROBLEM EXECUTING PROXY "+d.proxy+": "+f.message)}}}]),angular.module("MRS.App.Core").service("eventPublisher",["$rootScope","$log",function(a,b){"use strict";this.events={JOB_CRASH:"MRSAPPCORE_JOB_CRASH",UNEXPECTED_ERROR:"MRSAPPCORE_UNEXPECTED_ERROR"},this.publish=function(c,d){b.debug("EVENT PUBLISHED: "+c+" - "+d),a.$broadcast.apply(a,arguments)}}]),angular.module("MRS.App.Core").factory("$exceptionHandler",["$injector",function(a){"use strict";return function(b,c){a.get("$log").error(b,c)}}]),angular.module("MRS.App.Core").factory("logger",["$injector",function(a){"use strict";return function(b,c){return{isDebug:c||!1,process:function(a,c,d){var e="["+a.toUpperCase()+"]::["+new Date+"] - ";b[a.toLowerCase()]?b[a.toLowerCase()](e+c):b.log(e+c),this.isDebug&&void 0!==d&&(b.debug?b.debug(d):b.log(d))},debug:function(a){this.process("debug",a)},log:function(a){this.process("log",a)},warn:function(a){this.process("warn",a)},info:function(a){this.process("info",a)},error:function(b){var c,d,e=a.get("eventPublisher");"string"==typeof b?c=b:"object"==typeof b&&void 0!==b.message?(c=b.message,d=b):c=JSON.stringify(b),this.process("error",c,d),e.publish(e.events.UNEXPECTED_ERROR,c,d)}}}}]),angular.module("MRS.App.Core").service("sessionProxy",["$window","$q",function(a){"use strict";var b=this;this.isJSON=function(a){var b=!0;if("object"!=typeof a)try{JSON.parse(a)}catch(c){b=!1}return b},this.pack=function(a){return angular.isString(a)?a:b.isJSON(a)?JSON.stringify(a):a.toString()},this.unpack=function(a){return b.isJSON(a)?JSON.parse(a):a},this.put=function(c,d){c&&a.sessionStorage.setItem(c.toString().toLowerCase(),b.pack(d))},this.get=function(c){var d=null;return c&&(d=a.sessionStorage.getItem(c.toString().toLowerCase())),d?b.unpack(d):null},this.dump=function(){var c,d,e,f=[];for(c=0;c<a.sessionStorage.length;c+=1)d=a.sessionStorage.key(c),e=b.get(d),f.push(e);return f},this.remove=function(b){b&&a.sessionStorage.removeItem(b.toString().toLowerCase())},this.clear=function(){a.sessionStorage.clear()}}]),angular.module("MRS.App.Core").service("sqliteProxy",["$window","$q","$cacheFactory",function(a,b,c){"use strict";var d,e=this;this.rawConnections=c("APP_SQL_DBS"),this.onTransactionError=function(a){d.reject(a.message)},this.onTransactionSuccess=function(a,b){d.resolve(b)},this.execute=function(a,c,f){return d=b.defer(),a.transaction(function(a){a.executeSql(c,f,e.onTransactionSuccess,e.onTransactionError)}),d.promise},this.open=function(b){var c=b.toLowerCase(),d=e.rawConnections.get(c);return(null===d||void 0===d)&&(d=a.sqlitePlugin.openDatabase({name:c}),e.rawConnections.put(c,d)),d},this.send=function(a){var b=this.open(a.dbname);return this.execute(b,a.query,a.params)}}]),angular.module("MRS.App.Core").service("storageProxy",["$window","$q",function(a){"use strict";var b=this;this.isJSON=function(a){var b=!0;if("object"!=typeof a)try{JSON.parse(a)}catch(c){b=!1}return b},this.pack=function(a){return angular.isString(a)?a:b.isJSON(a)?JSON.stringify(a):a.toString()},this.unpack=function(a){return b.isJSON(a)?JSON.parse(a):a},this.put=function(c,d){c&&a.localStorage.setItem(c.toString().toLowerCase(),b.pack(d))},this.get=function(c){var d=null;return c&&(d=a.localStorage.getItem(c.toString().toLowerCase())),d?b.unpack(d):null},this.dump=function(){var c,d,e,f=[];for(c=0;c<a.localStorage.length;c+=1)d=a.localStorage.key(c),e=b.get(d),f.push(e);return f},this.remove=function(b){b&&a.localStorage.removeItem(b.toString().toLowerCase())},this.clear=function(){a.localStorage.clear()}}]),angular.module("MRS.App.Core").service("webCache",["webHelper","storageProxy","$cacheFactory","$q","$timeout",function(a,b,c,d,e){"use strict";var f=this,g=c("WEB_REQ_CACHE");f.buildKey=function(a){var c=a.method+a.url+(void 0===a.data?"":b.pack(a.data));return c},f.get=function(c,d){var e,f=c.storageKey||c.cacheKey;return e=b.get(f),a.filter(f,e,d)},f.defer=function(a,b){var c=a.cacheKey,e=d.defer();return g.put(c,{handler:e,isSaving:b}),e.promise},f.saveWhenNeeded=function(a,c){var d,e=c.cacheKey,f=c.storageKey||c.cacheKey,h=!1;return d=g.get(e),d.isSaving&&(a.CACHE_TIMESTAMP=(new Date).getTime(),b.put(f,a),h=!0),h},f.finishPromise=function(b,c,d,e,f){var h,i=a.formatResponse(c,d,e,f),j=f.cacheKey;h=g.get(j),b?h.handler.resolve(i):h.handler.reject(i),g.remove(j)},f.resolve=function(a,b,c,d){f.finishPromise(!0,a,b,c,d)},f.reject=function(a,b,c,d){f.finishPromise(!1,a,b,c,d)},f.resolveAsync=function(a){e(function(){var b=f.get(a);f.resolve(b,304,function(){return void 0},a)})}}]),angular.module("MRS.App.Core").factory("webInterceptor",["$log","$q",function(a,b){"use strict";return{response:function(a){return 206===a.status?b.reject(a):a},responseError:function(c){return 0===c.status&&(c.status=404),a.error(JSON.stringify(c)),b.reject(c)}}}]),angular.module("MRS.App.Core").service("webProxy",["$http","$q","webCache",function(a,b,c){"use strict";var d=this,e=[];d.onRequestError=function(a,b,d,e){c.reject(a,b,d,e)},d.onRequestSuccess=function(a,b,d,e){a=a||{},c.saveWhenNeeded(a,e),c.resolve(a,b,d,e)},d.hit=function(f,g,h,i){var j,k,l,m=g||h,n=g?null===c.get(f,i):!0,o=(new Date).getTime().toString()+Math.random().toString(),p=!1;if(f.timeout||(j=f.groupName?f.groupName:"default"),j){for(l=0;l<e.length;l+=1)if(e[l].name===j){p=!0,k=e[l].defer;break}p||(k=b.defer(),e.push({name:j,defer:k})),f.timeout=k.promise}return f.storageKey=c.buildKey(f),f.cacheKey=f.storageKey+o,n?a(f).success(d.onRequestSuccess).error(d.onRequestError):c.resolveAsync(f),c.defer(f,m)},d.cancelRequest=function(a){var b,c,d=Array.isArray(a);for((!d||d&&0===a.length)&&(a=["default"]),b=e.length-1;b>=0;b-=1)for(c=0;c<a.length;c+=1)e[b].name===a[c]&&(e[b].defer.resolve("cancelled"),e.splice(b,1))},d.send=function(a){var b=void 0===a.cache?!1:a.cache,c=void 0===a.forceHit?!1:a.forceHit,e={url:a.url,method:a.method.toUpperCase(),cache:!1};return void 0!==a.data&&(e.data=a.data),a.auth&&(e.auth=!0),void 0!==a.timeout&&(e.timeout=a.timeout),void 0!==a.groupName&&(e.groupName=a.groupName),d.hit(e,b,c,a.timestamp)}}]);
//# sourceMappingURL=mrs-app-core.min.js.map